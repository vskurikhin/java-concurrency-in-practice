/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java application project to get you started.
 * For more details take a look at the 'Building Java & JVM projects' chapter in the Gradle
 * User Manual available at https://docs.gradle.org/7.4/userguide/building_java_projects.html
 */

buildscript {
    repositories {
        gradlePluginPortal()
        maven { url 'https://repo.spring.io/plugins-snapshot' }
        maven { url 'https://plugins.gradle.org/m2/' }
    }
}

plugins {
    // Apply the application plugin to add support for building a CLI application in Java.
    id 'application'
    id 'com.github.johnrengelman.shadow' version '7.1.2'
    id 'idea'
    id 'java'
}

static def getEnv(key, defaultValue) {
    return System.getenv(key) ?: defaultValue
}

ext.libVers = [
        assertj_core                    : '3.22.0',
        cglib                           : '3.3.0',
        jackson                         : '2.13.2',
        javax_servlet_api               : '4.0.1',
        jcip_annotations                : '1.0',
        jstl                            : '1.2',
        jul_to_slf4j                    : '1.7.36',
        junit                           : '5.8.1',
        logback_classic                 : '1.2.10',
        org_reflections                 : '0.10.2',
        springframework                 : '5.3.16',
        tomcat_embed_core               : '9.0.58',
]

configurations {
    developmentOnly
    runtimeClasspath {
        extendsFrom developmentOnly
    }
    compileOnly {
        extendsFrom annotationProcessor
    }
    springinstrument
}

repositories {
    // Use Maven Central for resolving dependencies.
    mavenCentral()
}

dependencies {
    // This dependency is used by the application.
    implementation "cglib:cglib:$libVers.cglib"
    implementation "ch.qos.logback:logback-classic:$libVers.logback_classic"
    implementation "com.fasterxml.jackson.core:jackson-annotations:$libVers.jackson"
    implementation "com.fasterxml.jackson.core:jackson-core:$libVers.jackson"
    implementation "com.fasterxml.jackson.core:jackson-databind:$libVers.jackson"
    implementation "jstl:jstl:$libVers.jstl"
    implementation "net.jcip:jcip-annotations:$libVers.jcip_annotations"
    implementation "org.apache.tomcat.embed:tomcat-embed-core:$libVers.tomcat_embed_core"
    implementation "org.reflections:reflections:$libVers.org_reflections"
    implementation "org.slf4j:jul-to-slf4j:$libVers.jul_to_slf4j"
    implementation "org.springframework:spring-webmvc:$libVers.springframework"

    compileOnly "javax.servlet:javax.servlet-api:$libVers.javax_servlet_api"

    testImplementation 'org.assertj:assertj-core:3.22.0'
    testImplementation 'junit:junit:4.13.2'
}

compileJava.inputs.files(processResources)

application {
    // Define the main class for the application.
    mainClass = 'su.svn.Main'
}

shadowJar {
    archiveBaseName.set('application')
    archiveClassifier.set('')
    archiveVersion.set('')
    mergeServiceFiles('META-INF/spring.*')
}

jar {
    //noinspection GroovyAssignabilityCheck
    manifest {
        attributes("Main-Class": application.mainClass)
    }
}